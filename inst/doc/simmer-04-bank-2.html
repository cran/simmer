<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Duncan Garmonsway" />

<meta name="date" content="2024-07-04" />

<title>The Bank Tutorial: Part II</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">The Bank Tutorial: Part II</h1>
<h4 class="author">Duncan Garmonsway</h4>
<h4 class="date">2024-07-04</h4>


<div id="TOC">
<ul>
<li><a href="#introduction" id="toc-introduction">Introduction</a></li>
<li><a href="#priority-customers" id="toc-priority-customers">Priority
customers</a>
<ul>
<li><a href="#priority-customers-without-preemption" id="toc-priority-customers-without-preemption">Priority customers
without preemption</a></li>
<li><a href="#priority-customers-with-preemption" id="toc-priority-customers-with-preemption">Priority customers with
preemption</a></li>
</ul></li>
<li><a href="#balking-and-reneging-customers" id="toc-balking-and-reneging-customers">Balking and reneging
customers</a>
<ul>
<li><a href="#balking-customers" id="toc-balking-customers">Balking
customers</a></li>
<li><a href="#reneging-or-abandoning-customers" id="toc-reneging-or-abandoning-customers">Reneging (or abandoning)
customers</a></li>
</ul></li>
<li><a href="#interrupting-a-process" id="toc-interrupting-a-process">Interrupting a process</a></li>
<li><a href="#wait-until-the-bank-door-opens" id="toc-wait-until-the-bank-door-opens">Wait until the bank door
opens</a></li>
<li><a href="#wait-for-the-doorman-to-give-a-signal" id="toc-wait-for-the-doorman-to-give-a-signal">Wait for the doorman to
give a signal</a>
<ul>
<li><a href="#monitors" id="toc-monitors">Monitors</a>
<ul>
<li><a href="#plotting-a-histogram-of-monitor-results" id="toc-plotting-a-histogram-of-monitor-results">Plotting a histogram of
monitor results</a></li>
<li><a href="#monitoring-a-resource" id="toc-monitoring-a-resource">Monitoring a resource</a></li>
<li><a href="#plotting-from-resource-monitors" id="toc-plotting-from-resource-monitors">Plotting from resource
monitors</a></li>
</ul></li>
</ul></li>
</ul>
</div>

<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>This tutorial is adapted from a tutorial for the Python 2 package
‘SimPy’, <a href="https://pythonhosted.org/SimPy/Tutorials/TheBank2.html">here</a>.
Users familiar with SimPy may find this tutorial helpful for
transitioning to <code>simmer</code>. Some very basic material is not
covered. Beginners should first read <a href="simmer-04-bank-1.html"><em>The Bank Tutorial: Part I</em></a>.</p>
</div>
<div id="priority-customers" class="section level2">
<h2>Priority customers</h2>
<p>In many situations there is a system of priority service. Those
customers with high priority are served first, those with low priority
must wait. In some cases, preemptive priority will even allow a
high-priority customer to interrupt the service of one with a lower
priority.</p>
<p>Simmer implements priority requests with an extra integer priority
argument to <code>add_generator()</code>. By default, priority is zero;
higher integers have higher priority. For this to operate, the resource
must have been created with <code>preemptive = TRUE</code>.</p>
<div id="priority-customers-without-preemption" class="section level3">
<h3>Priority customers without preemption</h3>
<p>In the first example, we modify the program with random arrivals, one
counter, and a fixed service time (like <em>One Service counter</em> in
<em>The Bank Tutorial: Part I</em>) to process a high priority
customer.</p>
<p>Here, we give each customer a priority. Since the default is
<code>priority = 0</code> this is easy for most of them.</p>
<p>To observe the priority in action, while all other customers have the
default priority of 0, we create and activate one special customer,
Guido, with priority 1 who arrives at time 23. This is to ensure that he
arrives after Customer2.</p>
<p>Since the activity trace does not produce the waiting time by
default, this is calculated and appended using the
<code>transform</code> function.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(simmer)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1933</span>)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>bank <span class="ot">&lt;-</span> <span class="fu">simmer</span>()</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>customer <span class="ot">&lt;-</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>  <span class="fu">trajectory</span>(<span class="st">&quot;Customer&#39;s path&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>  <span class="fu">set_attribute</span>(<span class="st">&quot;start_time&quot;</span>, <span class="cf">function</span>() {<span class="fu">now</span>(bank)}) <span class="sc">%&gt;%</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>  <span class="fu">log_</span>(<span class="cf">function</span>() {</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>         <span class="fu">paste</span>(<span class="st">&quot;Queue is&quot;</span>, <span class="fu">get_queue_count</span>(bank, <span class="st">&quot;counter&quot;</span>), <span class="st">&quot;on arrival&quot;</span>)</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>         }) <span class="sc">%&gt;%</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>  <span class="fu">seize</span>(<span class="st">&quot;counter&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>  <span class="fu">log_</span>(<span class="cf">function</span>() {<span class="fu">paste</span>(<span class="st">&quot;Waited&quot;</span>, <span class="fu">now</span>(bank) <span class="sc">-</span> <span class="fu">get_attribute</span>(bank, <span class="st">&quot;start_time&quot;</span>))}) <span class="sc">%&gt;%</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>  <span class="fu">timeout</span>(<span class="dv">12</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>  <span class="fu">release</span>(<span class="st">&quot;counter&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>  <span class="fu">log_</span>(<span class="st">&quot;Completed&quot;</span>)</span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>bank <span class="ot">&lt;-</span></span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a>  <span class="fu">simmer</span>(<span class="st">&quot;bank&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a>  <span class="fu">add_resource</span>(<span class="st">&quot;counter&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a>  <span class="fu">add_generator</span>(<span class="st">&quot;Customer&quot;</span>, customer, <span class="cf">function</span>() {<span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">rexp</span>(<span class="dv">4</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>), <span class="sc">-</span><span class="dv">1</span>)}) <span class="sc">%&gt;%</span></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a>  <span class="fu">add_generator</span>(<span class="st">&quot;Guido&quot;</span>, customer, <span class="fu">at</span>(<span class="dv">23</span>), <span class="at">priority =</span> <span class="dv">1</span>)</span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a>bank <span class="sc">%&gt;%</span> <span class="fu">run</span>(<span class="at">until =</span> <span class="dv">400</span>)</span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a><span class="co">#&gt; 0: Customer0: Queue is 0 on arrival</span></span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a><span class="co">#&gt; 0: Customer0: Waited 0</span></span>
<span id="cb1-28"><a href="#cb1-28" tabindex="-1"></a><span class="co">#&gt; 0.177365: Customer1: Queue is 0 on arrival</span></span>
<span id="cb1-29"><a href="#cb1-29" tabindex="-1"></a><span class="co">#&gt; 8.64106: Customer2: Queue is 1 on arrival</span></span>
<span id="cb1-30"><a href="#cb1-30" tabindex="-1"></a><span class="co">#&gt; 12: Customer0: Completed</span></span>
<span id="cb1-31"><a href="#cb1-31" tabindex="-1"></a><span class="co">#&gt; 12: Customer1: Waited 11.8226352687925</span></span>
<span id="cb1-32"><a href="#cb1-32" tabindex="-1"></a><span class="co">#&gt; 21.1346: Customer3: Queue is 1 on arrival</span></span>
<span id="cb1-33"><a href="#cb1-33" tabindex="-1"></a><span class="co">#&gt; 23: Guido0: Queue is 2 on arrival</span></span>
<span id="cb1-34"><a href="#cb1-34" tabindex="-1"></a><span class="co">#&gt; 24: Customer1: Completed</span></span>
<span id="cb1-35"><a href="#cb1-35" tabindex="-1"></a><span class="co">#&gt; 24: Guido0: Waited 1</span></span>
<span id="cb1-36"><a href="#cb1-36" tabindex="-1"></a><span class="co">#&gt; 28.0923: Customer4: Queue is 2 on arrival</span></span>
<span id="cb1-37"><a href="#cb1-37" tabindex="-1"></a><span class="co">#&gt; 36: Guido0: Completed</span></span>
<span id="cb1-38"><a href="#cb1-38" tabindex="-1"></a><span class="co">#&gt; 36: Customer2: Waited 27.3589401547341</span></span>
<span id="cb1-39"><a href="#cb1-39" tabindex="-1"></a><span class="co">#&gt; 48: Customer2: Completed</span></span>
<span id="cb1-40"><a href="#cb1-40" tabindex="-1"></a><span class="co">#&gt; 48: Customer3: Waited 26.8654149797765</span></span>
<span id="cb1-41"><a href="#cb1-41" tabindex="-1"></a><span class="co">#&gt; 60: Customer3: Completed</span></span>
<span id="cb1-42"><a href="#cb1-42" tabindex="-1"></a><span class="co">#&gt; 60: Customer4: Waited 31.9076510670601</span></span>
<span id="cb1-43"><a href="#cb1-43" tabindex="-1"></a><span class="co">#&gt; 72: Customer4: Completed</span></span>
<span id="cb1-44"><a href="#cb1-44" tabindex="-1"></a><span class="co">#&gt; simmer environment: bank | now: 72 | next: </span></span>
<span id="cb1-45"><a href="#cb1-45" tabindex="-1"></a><span class="co">#&gt; { Monitor: in memory }</span></span>
<span id="cb1-46"><a href="#cb1-46" tabindex="-1"></a><span class="co">#&gt; { Resource: counter | monitored: TRUE | server status: 0(1) | queue status: 0(Inf) }</span></span>
<span id="cb1-47"><a href="#cb1-47" tabindex="-1"></a><span class="co">#&gt; { Source: Customer | monitored: 1 | n_generated: 5 }</span></span>
<span id="cb1-48"><a href="#cb1-48" tabindex="-1"></a><span class="co">#&gt; { Source: Guido | monitored: 1 | n_generated: 1 }</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>bank <span class="sc">%&gt;%</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>  <span class="fu">get_mon_arrivals</span>() <span class="sc">%&gt;%</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>  <span class="fu">transform</span>(<span class="at">waiting_time =</span> end_time <span class="sc">-</span> start_time <span class="sc">-</span> activity_time)</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co">#&gt;        name start_time end_time activity_time finished replication waiting_time</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="co">#&gt; 1 Customer0  0.0000000       12            12     TRUE           1      0.00000</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co">#&gt; 2 Customer1  0.1773647       24            12     TRUE           1     11.82264</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co">#&gt; 3    Guido0 23.0000000       36            12     TRUE           1      1.00000</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="co">#&gt; 4 Customer2  8.6410598       48            12     TRUE           1     27.35894</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="co">#&gt; 5 Customer3 21.1345850       60            12     TRUE           1     26.86541</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="co">#&gt; 6 Customer4 28.0923489       72            12     TRUE           1     31.90765</span></span></code></pre></div>
<p>The output above displays the number of customers in the queue just
as each one arrives. That count does not include any customer in
service.</p>
<p>Reading carefully one can see that when Guido arrives Customer0 has
been served and left at 12, Customer1 is in service and two (customers 2
and 3) are queueing. Guido has priority over those waiting and is served
before them at 24. When Guido leaves at 36, Customer2 starts
service.</p>
</div>
<div id="priority-customers-with-preemption" class="section level3">
<h3>Priority customers with preemption</h3>
<p>Now we allow Guido to have preemptive priority. He will displace any
customer in service when he arrives. That customer will resume when
Guido finishes (unless higher priority customers intervene). It requires
only a change to one line of the program, adding the argument,
<code>preemptive = TRUE</code> to the <code>add_resource</code> function
call.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">library</span>(simmer)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1933</span>)</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>bank <span class="ot">&lt;-</span> <span class="fu">simmer</span>()</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>customer <span class="ot">&lt;-</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>  <span class="fu">trajectory</span>(<span class="st">&quot;Customer&#39;s path&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>  <span class="fu">set_attribute</span>(<span class="st">&quot;start_time&quot;</span>, <span class="cf">function</span>() {<span class="fu">now</span>(bank)}) <span class="sc">%&gt;%</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>  <span class="fu">log_</span>(<span class="cf">function</span>() {</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>         <span class="fu">paste</span>(<span class="st">&quot;Queue is&quot;</span>, <span class="fu">get_queue_count</span>(bank, <span class="st">&quot;counter&quot;</span>), <span class="st">&quot;on arrival&quot;</span>)</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>         }) <span class="sc">%&gt;%</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>  <span class="fu">seize</span>(<span class="st">&quot;counter&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>  <span class="fu">log_</span>(<span class="cf">function</span>() {<span class="fu">paste</span>(<span class="st">&quot;Waited&quot;</span>, <span class="fu">now</span>(bank) <span class="sc">-</span> <span class="fu">get_attribute</span>(bank, <span class="st">&quot;start_time&quot;</span>))}) <span class="sc">%&gt;%</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>  <span class="fu">timeout</span>(<span class="dv">12</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>  <span class="fu">release</span>(<span class="st">&quot;counter&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>  <span class="fu">log_</span>(<span class="st">&quot;Completed&quot;</span>)</span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a>bank <span class="ot">&lt;-</span></span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a>  <span class="fu">simmer</span>(<span class="st">&quot;bank&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a>  <span class="fu">add_resource</span>(<span class="st">&quot;counter&quot;</span>, <span class="at">preemptive =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a>  <span class="fu">add_generator</span>(<span class="st">&quot;Customer&quot;</span>, customer, <span class="cf">function</span>() {<span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">rexp</span>(<span class="dv">4</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>), <span class="sc">-</span><span class="dv">1</span>)}) <span class="sc">%&gt;%</span></span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a>  <span class="fu">add_generator</span>(<span class="st">&quot;Guido&quot;</span>, customer, <span class="fu">at</span>(<span class="dv">23</span>), <span class="at">priority =</span> <span class="dv">1</span>)</span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a>bank <span class="sc">%&gt;%</span> <span class="fu">run</span>(<span class="at">until =</span> <span class="dv">400</span>)</span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a><span class="co">#&gt; 0: Customer0: Queue is 0 on arrival</span></span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a><span class="co">#&gt; 0: Customer0: Waited 0</span></span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a><span class="co">#&gt; 0.177365: Customer1: Queue is 0 on arrival</span></span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a><span class="co">#&gt; 8.64106: Customer2: Queue is 1 on arrival</span></span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a><span class="co">#&gt; 12: Customer0: Completed</span></span>
<span id="cb3-31"><a href="#cb3-31" tabindex="-1"></a><span class="co">#&gt; 12: Customer1: Waited 11.8226352687925</span></span>
<span id="cb3-32"><a href="#cb3-32" tabindex="-1"></a><span class="co">#&gt; 21.1346: Customer3: Queue is 1 on arrival</span></span>
<span id="cb3-33"><a href="#cb3-33" tabindex="-1"></a><span class="co">#&gt; 23: Guido0: Queue is 2 on arrival</span></span>
<span id="cb3-34"><a href="#cb3-34" tabindex="-1"></a><span class="co">#&gt; 23: Guido0: Waited 0</span></span>
<span id="cb3-35"><a href="#cb3-35" tabindex="-1"></a><span class="co">#&gt; 28.0923: Customer4: Queue is 3 on arrival</span></span>
<span id="cb3-36"><a href="#cb3-36" tabindex="-1"></a><span class="co">#&gt; 35: Guido0: Completed</span></span>
<span id="cb3-37"><a href="#cb3-37" tabindex="-1"></a><span class="co">#&gt; 36: Customer1: Completed</span></span>
<span id="cb3-38"><a href="#cb3-38" tabindex="-1"></a><span class="co">#&gt; 36: Customer2: Waited 27.3589401547341</span></span>
<span id="cb3-39"><a href="#cb3-39" tabindex="-1"></a><span class="co">#&gt; 48: Customer2: Completed</span></span>
<span id="cb3-40"><a href="#cb3-40" tabindex="-1"></a><span class="co">#&gt; 48: Customer3: Waited 26.8654149797765</span></span>
<span id="cb3-41"><a href="#cb3-41" tabindex="-1"></a><span class="co">#&gt; 60: Customer3: Completed</span></span>
<span id="cb3-42"><a href="#cb3-42" tabindex="-1"></a><span class="co">#&gt; 60: Customer4: Waited 31.9076510670601</span></span>
<span id="cb3-43"><a href="#cb3-43" tabindex="-1"></a><span class="co">#&gt; 72: Customer4: Completed</span></span>
<span id="cb3-44"><a href="#cb3-44" tabindex="-1"></a><span class="co">#&gt; simmer environment: bank | now: 72 | next: </span></span>
<span id="cb3-45"><a href="#cb3-45" tabindex="-1"></a><span class="co">#&gt; { Monitor: in memory }</span></span>
<span id="cb3-46"><a href="#cb3-46" tabindex="-1"></a><span class="co">#&gt; { Resource: counter | monitored: TRUE | server status: 0(1) | queue status: 0(Inf) }</span></span>
<span id="cb3-47"><a href="#cb3-47" tabindex="-1"></a><span class="co">#&gt; { Source: Customer | monitored: 1 | n_generated: 5 }</span></span>
<span id="cb3-48"><a href="#cb3-48" tabindex="-1"></a><span class="co">#&gt; { Source: Guido | monitored: 1 | n_generated: 1 }</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>bank <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>  <span class="fu">get_mon_arrivals</span>() <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>  <span class="fu">transform</span>(<span class="at">waiting_time =</span> end_time <span class="sc">-</span> start_time <span class="sc">-</span> activity_time)</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co">#&gt;        name start_time end_time activity_time finished replication waiting_time</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="co">#&gt; 1 Customer0  0.0000000       12            12     TRUE           1      0.00000</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="co">#&gt; 2    Guido0 23.0000000       35            12     TRUE           1      0.00000</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="co">#&gt; 3 Customer1  0.1773647       36            12     TRUE           1     23.82264</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="co">#&gt; 4 Customer2  8.6410598       48            12     TRUE           1     27.35894</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="co">#&gt; 5 Customer3 21.1345850       60            12     TRUE           1     26.86541</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="co">#&gt; 6 Customer4 28.0923489       72            12     TRUE           1     31.90765</span></span></code></pre></div>
<p>Though Guido arrives at the same time, 23, he no longer has to wait
and immediately goes into service, displacing the incumbent, Customer1.
That customer had already completed 23 - 12 = 11 minutes of his service.
When Guido finishes at 35, Customer1 resumes service and takes 36 - 35 =
1 minutes to finish. His total service time is the same as before (12
minutes).</p>
</div>
</div>
<div id="balking-and-reneging-customers" class="section level2">
<h2>Balking and reneging customers</h2>
<p>Balking occurs when a customer refuses to join a queue if it is too
long. Reneging (or, better, abandonment) occurs if an impatient customer
gives up while still waiting and before being served.</p>
<div id="balking-customers" class="section level3">
<h3>Balking customers</h3>
<p>Another term for a system with balking customers is one where
“blocked customers” are “cleared”, termed by engineers a BCC system.
This is very convenient analytically in queueing theory and formulae
developed using this assumption are used extensively for planning
communication systems. The easiest case is when no queueing is
allowed.</p>
<p>As an example let us investigate a BCC system with a single server
but the waiting space is limited. We will estimate the rate of balking
when the maximum number in the queue is set to 1. On arrival into the
system the customer must first check to see if there is room. If there
is not enough room, the customer balks.</p>
<p>To get the balking rate, we first count the number of arrivals that
didn’t finish, using the data given by <code>get_mon_arrivals()</code>.
Then we divide it by the current model time from
<code>now(bank)</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">library</span>(simmer)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>timeInBank <span class="ot">&lt;-</span> <span class="dv">12</span> <span class="co"># mean, minutes</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>ARRint <span class="ot">&lt;-</span> <span class="dv">10</span>     <span class="co"># mean, minutes</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>numServers <span class="ot">&lt;-</span> <span class="dv">1</span>  <span class="co"># servers</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>maxInSystem <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="co"># customers</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>maxInQueue <span class="ot">&lt;-</span> maxInSystem <span class="sc">-</span> numServers</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>maxNumber <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>maxTime <span class="ot">&lt;-</span> <span class="dv">400</span>  <span class="co"># minutes</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">59098</span>)</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>bank <span class="ot">&lt;-</span> <span class="fu">simmer</span>()</span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>customer <span class="ot">&lt;-</span></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a>  <span class="fu">trajectory</span>(<span class="st">&quot;Customer&#39;s path&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a>  <span class="fu">log_</span>(<span class="st">&quot;Here I am&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a>  <span class="fu">set_attribute</span>(<span class="st">&quot;start_time&quot;</span>, <span class="cf">function</span>() {<span class="fu">now</span>(bank)}) <span class="sc">%&gt;%</span></span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a>  <span class="fu">seize</span>(<span class="st">&quot;counter&quot;</span>,</span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a>        <span class="at">continue =</span> <span class="cn">FALSE</span>,</span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a>        <span class="at">reject =</span> <span class="fu">trajectory</span>(<span class="st">&quot;Balked customer&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a>          <span class="fu">log_</span>(<span class="st">&quot;BALKING&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a>          <span class="fu">leave</span>(<span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a>  <span class="fu">log_</span>(<span class="cf">function</span>() {<span class="fu">paste</span>(<span class="st">&quot;Waited&quot;</span>, <span class="fu">now</span>(bank) <span class="sc">-</span> <span class="fu">get_attribute</span>(bank, <span class="st">&quot;start_time&quot;</span>))}) <span class="sc">%&gt;%</span></span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a>  <span class="fu">timeout</span>(<span class="cf">function</span>() {<span class="fu">rexp</span>(<span class="dv">1</span>, <span class="dv">1</span><span class="sc">/</span>timeInBank)}) <span class="sc">%&gt;%</span></span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a>  <span class="fu">release</span>(<span class="st">&quot;counter&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a>  <span class="fu">log_</span>(<span class="st">&quot;Finished&quot;</span>)</span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a></span>
<span id="cb5-29"><a href="#cb5-29" tabindex="-1"></a>bank <span class="ot">&lt;-</span></span>
<span id="cb5-30"><a href="#cb5-30" tabindex="-1"></a>  <span class="fu">simmer</span>(<span class="st">&quot;bank&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-31"><a href="#cb5-31" tabindex="-1"></a>  <span class="fu">add_resource</span>(<span class="st">&quot;counter&quot;</span>,</span>
<span id="cb5-32"><a href="#cb5-32" tabindex="-1"></a>               <span class="at">capacity =</span> numServers,</span>
<span id="cb5-33"><a href="#cb5-33" tabindex="-1"></a>               <span class="at">queue_size =</span> maxInQueue) <span class="sc">%&gt;%</span></span>
<span id="cb5-34"><a href="#cb5-34" tabindex="-1"></a>  <span class="fu">add_generator</span>(<span class="st">&quot;Customer&quot;</span>,</span>
<span id="cb5-35"><a href="#cb5-35" tabindex="-1"></a>                customer,</span>
<span id="cb5-36"><a href="#cb5-36" tabindex="-1"></a>                <span class="fu">at</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">cumsum</span>(<span class="fu">rexp</span>(maxNumber <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">1</span> <span class="sc">/</span> ARRint)))))</span>
<span id="cb5-37"><a href="#cb5-37" tabindex="-1"></a></span>
<span id="cb5-38"><a href="#cb5-38" tabindex="-1"></a>bank <span class="sc">%&gt;%</span> <span class="fu">run</span>(<span class="at">until =</span> maxTime)</span>
<span id="cb5-39"><a href="#cb5-39" tabindex="-1"></a><span class="co">#&gt; 0: Customer0: Here I am</span></span>
<span id="cb5-40"><a href="#cb5-40" tabindex="-1"></a><span class="co">#&gt; 0: Customer0: Waited 0</span></span>
<span id="cb5-41"><a href="#cb5-41" tabindex="-1"></a><span class="co">#&gt; 0.822239: Customer1: Here I am</span></span>
<span id="cb5-42"><a href="#cb5-42" tabindex="-1"></a><span class="co">#&gt; 1.01227: Customer2: Here I am</span></span>
<span id="cb5-43"><a href="#cb5-43" tabindex="-1"></a><span class="co">#&gt; 1.01227: Customer2: BALKING</span></span>
<span id="cb5-44"><a href="#cb5-44" tabindex="-1"></a><span class="co">#&gt; 4.7448: Customer3: Here I am</span></span>
<span id="cb5-45"><a href="#cb5-45" tabindex="-1"></a><span class="co">#&gt; 4.7448: Customer3: BALKING</span></span>
<span id="cb5-46"><a href="#cb5-46" tabindex="-1"></a><span class="co">#&gt; 20.5472: Customer4: Here I am</span></span>
<span id="cb5-47"><a href="#cb5-47" tabindex="-1"></a><span class="co">#&gt; 20.5472: Customer4: BALKING</span></span>
<span id="cb5-48"><a href="#cb5-48" tabindex="-1"></a><span class="co">#&gt; 21.6132: Customer5: Here I am</span></span>
<span id="cb5-49"><a href="#cb5-49" tabindex="-1"></a><span class="co">#&gt; 21.6132: Customer5: BALKING</span></span>
<span id="cb5-50"><a href="#cb5-50" tabindex="-1"></a><span class="co">#&gt; 22.7358: Customer0: Finished</span></span>
<span id="cb5-51"><a href="#cb5-51" tabindex="-1"></a><span class="co">#&gt; 22.7358: Customer1: Waited 21.9136007670654</span></span>
<span id="cb5-52"><a href="#cb5-52" tabindex="-1"></a><span class="co">#&gt; 23.5339: Customer6: Here I am</span></span>
<span id="cb5-53"><a href="#cb5-53" tabindex="-1"></a><span class="co">#&gt; 32.1107: Customer7: Here I am</span></span>
<span id="cb5-54"><a href="#cb5-54" tabindex="-1"></a><span class="co">#&gt; 32.1107: Customer7: BALKING</span></span>
<span id="cb5-55"><a href="#cb5-55" tabindex="-1"></a><span class="co">#&gt; 33.4243: Customer1: Finished</span></span>
<span id="cb5-56"><a href="#cb5-56" tabindex="-1"></a><span class="co">#&gt; 33.4243: Customer6: Waited 9.89045904344415</span></span>
<span id="cb5-57"><a href="#cb5-57" tabindex="-1"></a><span class="co">#&gt; 34.0249: Customer6: Finished</span></span>
<span id="cb5-58"><a href="#cb5-58" tabindex="-1"></a><span class="co">#&gt; simmer environment: bank | now: 34.0249444457964 | next: </span></span>
<span id="cb5-59"><a href="#cb5-59" tabindex="-1"></a><span class="co">#&gt; { Monitor: in memory }</span></span>
<span id="cb5-60"><a href="#cb5-60" tabindex="-1"></a><span class="co">#&gt; { Resource: counter | monitored: TRUE | server status: 0(1) | queue status: 0(1) }</span></span>
<span id="cb5-61"><a href="#cb5-61" tabindex="-1"></a><span class="co">#&gt; { Source: Customer | monitored: 1 | n_generated: 8 }</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>number_balked <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">get_mon_arrivals</span>(bank)<span class="sc">$</span>finished)</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">&quot;Balking rate is&quot;</span>, number_balked <span class="sc">/</span> <span class="fu">now</span>(bank), <span class="st">&quot;customers per minute.&quot;</span>)</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Balking rate is 0.146951011425317 customers per minute.&quot;</span></span></code></pre></div>
<p>When Customer2 arrives, Customer0 is already in service and Customer1
is waiting. There is no room, so Customer2 balks. By the vagaries of
exponential random numbers, Customer0 takes a very long time to serve
(22.7358 minutes) so the first one to find room is number Customer6 at
25.5339.</p>
</div>
<div id="reneging-or-abandoning-customers" class="section level3">
<h3>Reneging (or abandoning) customers</h3>
<p>Often in practice an impatient customer will leave the queue before
being served. Simmer can model this reneging behaviour using the
<code>renege_in()</code> function in a trajectory. This defines the
maximum time that a customer will wait before reneging, as well as an
‘out’ trajectory for them to follow when they renege.</p>
<p>If the customer reaches the server before reneging, then their
impatience must be cancelled with the <code>renege_abort()</code>
function.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">library</span>(simmer)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>timeInBank <span class="ot">&lt;-</span> <span class="dv">15</span> <span class="co"># mean, minutes</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>ARRint <span class="ot">&lt;-</span> <span class="dv">10</span>     <span class="co"># mean, minutes</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>numServers <span class="ot">&lt;-</span> <span class="dv">1</span>  <span class="co"># servers</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>maxNumber <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>maxTime <span class="ot">&lt;-</span> <span class="dv">400</span>   <span class="co"># minutes</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>maxWaitTime <span class="ot">&lt;-</span> <span class="dv">12</span> <span class="co"># minutes, maximum time to wait before reneging</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">59030</span>)</span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>bank <span class="ot">&lt;-</span> <span class="fu">simmer</span>()</span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>customer <span class="ot">&lt;-</span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>  <span class="fu">trajectory</span>(<span class="st">&quot;Customer&#39;s path&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a>  <span class="fu">log_</span>(<span class="st">&quot;Here I am&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a>  <span class="fu">set_attribute</span>(<span class="st">&quot;start_time&quot;</span>, <span class="cf">function</span>() {<span class="fu">now</span>(bank)}) <span class="sc">%&gt;%</span></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a>  <span class="fu">renege_in</span>(maxWaitTime,</span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a>            <span class="at">out =</span> <span class="fu">trajectory</span>(<span class="st">&quot;Reneging customer&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a>              <span class="fu">log_</span>(<span class="cf">function</span>() {</span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a>                     <span class="fu">paste</span>(<span class="st">&quot;Waited&quot;</span>, <span class="fu">now</span>(bank) <span class="sc">-</span> <span class="fu">get_attribute</span>(bank, <span class="st">&quot;start_time&quot;</span>), <span class="st">&quot;I am off&quot;</span>)</span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a>                   })) <span class="sc">%&gt;%</span></span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a>  <span class="fu">seize</span>(<span class="st">&quot;counter&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a>  <span class="fu">renege_abort</span>() <span class="sc">%&gt;%</span> <span class="co"># Stay if I&#39;m being attended within maxWaitTime</span></span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a>  <span class="fu">log_</span>(<span class="cf">function</span>() {<span class="fu">paste</span>(<span class="st">&quot;Waited&quot;</span>, <span class="fu">now</span>(bank) <span class="sc">-</span> <span class="fu">get_attribute</span>(bank, <span class="st">&quot;start_time&quot;</span>))}) <span class="sc">%&gt;%</span></span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a>  <span class="fu">timeout</span>(<span class="cf">function</span>() {<span class="fu">rexp</span>(<span class="dv">1</span>, <span class="dv">1</span><span class="sc">/</span>timeInBank)}) <span class="sc">%&gt;%</span></span>
<span id="cb7-27"><a href="#cb7-27" tabindex="-1"></a>  <span class="fu">release</span>(<span class="st">&quot;counter&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-28"><a href="#cb7-28" tabindex="-1"></a>  <span class="fu">log_</span>(<span class="st">&quot;Completed&quot;</span>)</span>
<span id="cb7-29"><a href="#cb7-29" tabindex="-1"></a></span>
<span id="cb7-30"><a href="#cb7-30" tabindex="-1"></a>bank <span class="ot">&lt;-</span></span>
<span id="cb7-31"><a href="#cb7-31" tabindex="-1"></a>  <span class="fu">simmer</span>(<span class="st">&quot;bank&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-32"><a href="#cb7-32" tabindex="-1"></a>  <span class="fu">add_resource</span>(<span class="st">&quot;counter&quot;</span>,</span>
<span id="cb7-33"><a href="#cb7-33" tabindex="-1"></a>               <span class="at">capacity =</span> numServers) <span class="sc">%&gt;%</span></span>
<span id="cb7-34"><a href="#cb7-34" tabindex="-1"></a>  <span class="fu">add_generator</span>(<span class="st">&quot;Customer&quot;</span>,</span>
<span id="cb7-35"><a href="#cb7-35" tabindex="-1"></a>                customer,</span>
<span id="cb7-36"><a href="#cb7-36" tabindex="-1"></a>                <span class="fu">at</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">cumsum</span>(<span class="fu">rexp</span>(maxNumber <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">1</span> <span class="sc">/</span> ARRint)))))</span>
<span id="cb7-37"><a href="#cb7-37" tabindex="-1"></a></span>
<span id="cb7-38"><a href="#cb7-38" tabindex="-1"></a>bank <span class="sc">%&gt;%</span> <span class="fu">run</span>(<span class="at">until =</span> maxTime)</span>
<span id="cb7-39"><a href="#cb7-39" tabindex="-1"></a><span class="co">#&gt; 0: Customer0: Here I am</span></span>
<span id="cb7-40"><a href="#cb7-40" tabindex="-1"></a><span class="co">#&gt; 0: Customer0: Waited 0</span></span>
<span id="cb7-41"><a href="#cb7-41" tabindex="-1"></a><span class="co">#&gt; 16.5058: Customer1: Here I am</span></span>
<span id="cb7-42"><a href="#cb7-42" tabindex="-1"></a><span class="co">#&gt; 28.5058: Customer1: Waited 12 I am off</span></span>
<span id="cb7-43"><a href="#cb7-43" tabindex="-1"></a><span class="co">#&gt; 34.339: Customer2: Here I am</span></span>
<span id="cb7-44"><a href="#cb7-44" tabindex="-1"></a><span class="co">#&gt; 41.8687: Customer3: Here I am</span></span>
<span id="cb7-45"><a href="#cb7-45" tabindex="-1"></a><span class="co">#&gt; 46.339: Customer2: Waited 12 I am off</span></span>
<span id="cb7-46"><a href="#cb7-46" tabindex="-1"></a><span class="co">#&gt; 49.3671: Customer4: Here I am</span></span>
<span id="cb7-47"><a href="#cb7-47" tabindex="-1"></a><span class="co">#&gt; 53.8687: Customer3: Waited 12 I am off</span></span>
<span id="cb7-48"><a href="#cb7-48" tabindex="-1"></a><span class="co">#&gt; 54.7374: Customer0: Completed</span></span>
<span id="cb7-49"><a href="#cb7-49" tabindex="-1"></a><span class="co">#&gt; 54.7374: Customer4: Waited 5.37030150208617</span></span>
<span id="cb7-50"><a href="#cb7-50" tabindex="-1"></a><span class="co">#&gt; 64.6857: Customer4: Completed</span></span>
<span id="cb7-51"><a href="#cb7-51" tabindex="-1"></a><span class="co">#&gt; simmer environment: bank | now: 64.6856688172597 | next: </span></span>
<span id="cb7-52"><a href="#cb7-52" tabindex="-1"></a><span class="co">#&gt; { Monitor: in memory }</span></span>
<span id="cb7-53"><a href="#cb7-53" tabindex="-1"></a><span class="co">#&gt; { Resource: counter | monitored: TRUE | server status: 0(1) | queue status: 0(Inf) }</span></span>
<span id="cb7-54"><a href="#cb7-54" tabindex="-1"></a><span class="co">#&gt; { Source: Customer | monitored: 1 | n_generated: 5 }</span></span></code></pre></div>
<p>Customer1 arrives after Customer0 but has only 12 minutes patience.
After that time in the queue (at time 28.5058) he abandons the queue to
leave Customer2 to take his place. Customer2 and Customer3 also renege.
Customer4 is served within 12 minutes.</p>
</div>
</div>
<div id="interrupting-a-process" class="section level2">
<h2>Interrupting a process</h2>
<p>Klaus goes into the bank to talk to the manager. For clarity we
ignore the counters and other customers. During his conversation his
cellphone rings. When he finishes the call he continues the
conversation.</p>
<p>In this example, the call is another trajectory, whose only
activities are to send a signal (the ringing of the phone), and to write
that event to the log.</p>
<p>In Klaus’ trajectory, the <code>trap</code> activity causes him to
listen for the phone to ring. Supposing the phone doesn’t ring, then his
trajectory would continue to the <code>timeout</code> activity, where he
would do his banking business for 20 minutes, and then finish.</p>
<p>Supposing the phone <em>does</em> ring, then Klaus would enter the
sub-trajectory defined within the <code>trap</code> function as a
‘handler’. In that trajectory, he makes his excuses, answers the phone,
then returns to business. At the end of the trajectory, he continues the
original trajectory at the next step <em>following</em> the original
<code>timeout</code>, without spending the rest of the 20 minutes on his
banking.</p>
<p>To make Klaus spend a full 20 minutes banking, we add a
<code>timeout</code> activity to the end of the ‘handler’, but first we
have to calculate how much time remains after the interruption. This is
done by storing the ‘start’ time in an attribute, and calculating how
much time is left when the phone rings.</p>
<p>By default, interruptions can themselves be interrupted, as
illustrated in this example by the phone ringing twice. This could be
avoided by setting <code>interruptible = FALSE</code> in the
<code>trap</code> activity.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">library</span>(simmer)</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>timeInBank <span class="ot">&lt;-</span>  <span class="dv">20</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>timeOfCall <span class="ot">&lt;-</span>   <span class="dv">9</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>onphone    <span class="ot">&lt;-</span>   <span class="dv">3</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>maxTime    <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>bank <span class="ot">&lt;-</span> <span class="fu">simmer</span>()</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>customer <span class="ot">&lt;-</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>  <span class="fu">trajectory</span>(<span class="st">&quot;Customer&#39;s path&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>  <span class="fu">trap</span>(<span class="st">&quot;phonecall&quot;</span>,</span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>       <span class="at">handler =</span> <span class="fu">trajectory</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>         <span class="fu">log_</span>(<span class="st">&quot;Excuse me&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a>         <span class="fu">set_attribute</span>(</span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a>           <span class="st">&quot;timeleft&quot;</span>, <span class="cf">function</span>() {</span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a>             <span class="fu">sum</span>(<span class="fu">get_attribute</span>(bank, <span class="fu">c</span>(<span class="st">&quot;timeleft&quot;</span>, <span class="st">&quot;start&quot;</span>))) <span class="sc">-</span> <span class="fu">now</span>(bank)</span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a>         }) <span class="sc">%&gt;%</span></span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a>         <span class="fu">log_</span>(<span class="st">&quot;Hello! I&#39;ll call back&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a>         <span class="fu">timeout</span>(onphone) <span class="sc">%&gt;%</span></span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a>         <span class="fu">log_</span>(<span class="st">&quot;Sorry, where were we?&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a>         <span class="fu">set_attribute</span>(<span class="st">&quot;start&quot;</span>, <span class="cf">function</span>() {<span class="fu">now</span>(bank)}) <span class="sc">%&gt;%</span></span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a>         <span class="fu">log_</span>(<span class="cf">function</span>() {<span class="fu">paste</span>(<span class="st">&quot;Time left:&quot;</span>, <span class="fu">get_attribute</span>(bank, <span class="st">&quot;timeleft&quot;</span>))}) <span class="sc">%&gt;%</span></span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a>         <span class="fu">timeout_from_attribute</span>(<span class="st">&quot;timeleft&quot;</span>)</span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a>       ) <span class="sc">%&gt;%</span></span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a>  <span class="fu">log_</span>(<span class="st">&quot;Here I am&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-27"><a href="#cb8-27" tabindex="-1"></a>  <span class="fu">set_attribute</span>(<span class="st">&quot;timeleft&quot;</span>, timeInBank) <span class="sc">%&gt;%</span></span>
<span id="cb8-28"><a href="#cb8-28" tabindex="-1"></a>  <span class="fu">set_attribute</span>(<span class="st">&quot;start&quot;</span>, <span class="cf">function</span>() {<span class="fu">now</span>(bank)}) <span class="sc">%&gt;%</span></span>
<span id="cb8-29"><a href="#cb8-29" tabindex="-1"></a>  <span class="fu">timeout</span>(timeInBank) <span class="sc">%&gt;%</span></span>
<span id="cb8-30"><a href="#cb8-30" tabindex="-1"></a>  <span class="fu">log_</span>(<span class="st">&quot;Completed&quot;</span>)</span>
<span id="cb8-31"><a href="#cb8-31" tabindex="-1"></a></span>
<span id="cb8-32"><a href="#cb8-32" tabindex="-1"></a>phone <span class="ot">&lt;-</span></span>
<span id="cb8-33"><a href="#cb8-33" tabindex="-1"></a>  <span class="fu">trajectory</span>(<span class="st">&quot;Phone&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-34"><a href="#cb8-34" tabindex="-1"></a>  <span class="fu">log_</span>(<span class="st">&quot;Ringgg!&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-35"><a href="#cb8-35" tabindex="-1"></a>  <span class="fu">send</span>(<span class="st">&quot;phonecall&quot;</span>)</span>
<span id="cb8-36"><a href="#cb8-36" tabindex="-1"></a></span>
<span id="cb8-37"><a href="#cb8-37" tabindex="-1"></a>bank <span class="ot">&lt;-</span></span>
<span id="cb8-38"><a href="#cb8-38" tabindex="-1"></a>  <span class="fu">simmer</span>(<span class="st">&quot;bank&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-39"><a href="#cb8-39" tabindex="-1"></a>  <span class="fu">add_generator</span>(<span class="st">&quot;Klaus&quot;</span>, customer, <span class="fu">at</span>(<span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-40"><a href="#cb8-40" tabindex="-1"></a>  <span class="fu">add_generator</span>(<span class="st">&quot;Phone&quot;</span>, phone, <span class="fu">at</span>(timeOfCall, timeOfCall <span class="sc">+</span> <span class="dv">7</span>))</span>
<span id="cb8-41"><a href="#cb8-41" tabindex="-1"></a></span>
<span id="cb8-42"><a href="#cb8-42" tabindex="-1"></a>bank <span class="sc">%&gt;%</span> <span class="fu">run</span>(<span class="at">until =</span> maxTime)</span>
<span id="cb8-43"><a href="#cb8-43" tabindex="-1"></a><span class="co">#&gt; 0: Klaus0: Here I am</span></span>
<span id="cb8-44"><a href="#cb8-44" tabindex="-1"></a><span class="co">#&gt; 9: Phone0: Ringgg!</span></span>
<span id="cb8-45"><a href="#cb8-45" tabindex="-1"></a><span class="co">#&gt; 9: Klaus0: Excuse me</span></span>
<span id="cb8-46"><a href="#cb8-46" tabindex="-1"></a><span class="co">#&gt; 9: Klaus0: Hello! I&#39;ll call back</span></span>
<span id="cb8-47"><a href="#cb8-47" tabindex="-1"></a><span class="co">#&gt; 12: Klaus0: Sorry, where were we?</span></span>
<span id="cb8-48"><a href="#cb8-48" tabindex="-1"></a><span class="co">#&gt; 12: Klaus0: Time left: 11</span></span>
<span id="cb8-49"><a href="#cb8-49" tabindex="-1"></a><span class="co">#&gt; 16: Phone1: Ringgg!</span></span>
<span id="cb8-50"><a href="#cb8-50" tabindex="-1"></a><span class="co">#&gt; 16: Klaus0: Excuse me</span></span>
<span id="cb8-51"><a href="#cb8-51" tabindex="-1"></a><span class="co">#&gt; 16: Klaus0: Hello! I&#39;ll call back</span></span>
<span id="cb8-52"><a href="#cb8-52" tabindex="-1"></a><span class="co">#&gt; 19: Klaus0: Sorry, where were we?</span></span>
<span id="cb8-53"><a href="#cb8-53" tabindex="-1"></a><span class="co">#&gt; 19: Klaus0: Time left: 7</span></span>
<span id="cb8-54"><a href="#cb8-54" tabindex="-1"></a><span class="co">#&gt; 26: Klaus0: Completed</span></span>
<span id="cb8-55"><a href="#cb8-55" tabindex="-1"></a><span class="co">#&gt; simmer environment: bank | now: 26 | next: </span></span>
<span id="cb8-56"><a href="#cb8-56" tabindex="-1"></a><span class="co">#&gt; { Monitor: in memory }</span></span>
<span id="cb8-57"><a href="#cb8-57" tabindex="-1"></a><span class="co">#&gt; { Source: Klaus | monitored: 1 | n_generated: 1 }</span></span>
<span id="cb8-58"><a href="#cb8-58" tabindex="-1"></a><span class="co">#&gt; { Source: Phone | monitored: 1 | n_generated: 2 }</span></span></code></pre></div>
<p>As this has no random numbers the results are reasonably clear: the
first interrupting call occurs at 9. It takes Klaus 3 minutes to listen
to the message and he resumes the conversation with the bank manager at
12. The phone rings again at 16, he listens for three more minutes, and
resumes the conversation at 19, finally finishing at 26. The total time
of conversation is 9 + 4 + 7 = 20 minutes, the same as it would have
been if the interrupt had not occurred.</p>
</div>
<div id="wait-until-the-bank-door-opens" class="section level2">
<h2>Wait until the bank door opens</h2>
<p>Customers arrive at random, some of them getting to the bank before
the door is opened by a doorman. They wait for the door to be opened and
then rush in and queue to be served.</p>
<p>This model defines the door as a resource, just like the counter. The
capacity of the door is defined according to the <code>schedule</code>
function, so that it has zero capacity when it is shut, and infinite
capacity when it is open. Customers ‘seize’ the door and must then wait
until it has capacity to ‘serve’ them. Once it is available, all waiting
customers are ‘served’ immediately (i.e. they pass through the door).
There is no <code>timeout</code> between ‘seizing’ and ‘releasing’ the
door.</p>
<p>For the sake of announcing in the log that the door has been opened,
a doorman trajectory is defined.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">library</span>(simmer)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>maxTime <span class="ot">=</span> <span class="dv">400</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">393937</span>)</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>bank <span class="ot">&lt;-</span> <span class="fu">simmer</span>()</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>customer <span class="ot">&lt;-</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>  <span class="fu">trajectory</span>(<span class="st">&quot;Customer&#39;s path&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>  <span class="fu">log_</span>(<span class="cf">function</span>()</span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">get_capacity</span>(bank, <span class="st">&quot;door&quot;</span>) <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a>      <span class="st">&quot;Here I am but the door is shut.&quot;</span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a>    <span class="cf">else</span> <span class="st">&quot;Here I am and the door is open.&quot;</span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a>  <span class="fu">seize</span>(<span class="st">&quot;door&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a>  <span class="fu">log_</span>(<span class="st">&quot;I can go in!&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a>  <span class="fu">release</span>(<span class="st">&quot;door&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a>  <span class="fu">seize</span>(<span class="st">&quot;counter&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a>  <span class="fu">timeout</span>(<span class="cf">function</span>() {<span class="fu">rexp</span>(<span class="dv">1</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>)}) <span class="sc">%&gt;%</span></span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a>  <span class="fu">release</span>(<span class="st">&quot;counter&quot;</span>)</span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a></span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a>openTime <span class="ot">&lt;-</span> <span class="fu">rexp</span>(<span class="dv">1</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>)</span>
<span id="cb9-23"><a href="#cb9-23" tabindex="-1"></a></span>
<span id="cb9-24"><a href="#cb9-24" tabindex="-1"></a>door_schedule <span class="ot">&lt;-</span> <span class="fu">schedule</span>(<span class="fu">c</span>(<span class="dv">0</span>, openTime), <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">Inf</span>))</span>
<span id="cb9-25"><a href="#cb9-25" tabindex="-1"></a></span>
<span id="cb9-26"><a href="#cb9-26" tabindex="-1"></a>doorman <span class="ot">&lt;-</span></span>
<span id="cb9-27"><a href="#cb9-27" tabindex="-1"></a>  <span class="fu">trajectory</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-28"><a href="#cb9-28" tabindex="-1"></a>  <span class="fu">timeout</span>(openTime) <span class="sc">%&gt;%</span></span>
<span id="cb9-29"><a href="#cb9-29" tabindex="-1"></a>  <span class="fu">log_</span>(<span class="st">&quot;Ladies and Gentlemen! You may all enter.&quot;</span>)</span>
<span id="cb9-30"><a href="#cb9-30" tabindex="-1"></a></span>
<span id="cb9-31"><a href="#cb9-31" tabindex="-1"></a>bank <span class="ot">&lt;-</span></span>
<span id="cb9-32"><a href="#cb9-32" tabindex="-1"></a>  <span class="fu">simmer</span>(<span class="st">&quot;bank&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-33"><a href="#cb9-33" tabindex="-1"></a>  <span class="fu">add_resource</span>(<span class="st">&quot;door&quot;</span>, <span class="at">capacity =</span> door_schedule) <span class="sc">%&gt;%</span></span>
<span id="cb9-34"><a href="#cb9-34" tabindex="-1"></a>  <span class="fu">add_resource</span>(<span class="st">&quot;counter&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-35"><a href="#cb9-35" tabindex="-1"></a>  <span class="fu">add_generator</span>(<span class="st">&quot;Customer&quot;</span>,</span>
<span id="cb9-36"><a href="#cb9-36" tabindex="-1"></a>                customer,</span>
<span id="cb9-37"><a href="#cb9-37" tabindex="-1"></a>                <span class="fu">at</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">cumsum</span>(<span class="fu">rexp</span>(<span class="dv">5</span> <span class="sc">-</span> <span class="dv">1</span>, <span class="fl">0.1</span>))))) <span class="sc">%&gt;%</span></span>
<span id="cb9-38"><a href="#cb9-38" tabindex="-1"></a>  <span class="fu">add_generator</span>(<span class="st">&quot;Doorman&quot;</span>, doorman, <span class="fu">at</span>(<span class="dv">0</span>))</span>
<span id="cb9-39"><a href="#cb9-39" tabindex="-1"></a></span>
<span id="cb9-40"><a href="#cb9-40" tabindex="-1"></a>bank <span class="sc">%&gt;%</span> <span class="fu">run</span>(<span class="at">until =</span> maxTime)</span>
<span id="cb9-41"><a href="#cb9-41" tabindex="-1"></a><span class="co">#&gt; 0: Customer0: Here I am but the door is shut.</span></span>
<span id="cb9-42"><a href="#cb9-42" tabindex="-1"></a><span class="co">#&gt; 6.44076: Customer1: Here I am but the door is shut.</span></span>
<span id="cb9-43"><a href="#cb9-43" tabindex="-1"></a><span class="co">#&gt; 8.77564: Customer2: Here I am but the door is shut.</span></span>
<span id="cb9-44"><a href="#cb9-44" tabindex="-1"></a><span class="co">#&gt; 19.7241: Doorman0: Ladies and Gentlemen! You may all enter.</span></span>
<span id="cb9-45"><a href="#cb9-45" tabindex="-1"></a><span class="co">#&gt; 19.7241: Customer0: I can go in!</span></span>
<span id="cb9-46"><a href="#cb9-46" tabindex="-1"></a><span class="co">#&gt; 19.7241: Customer1: I can go in!</span></span>
<span id="cb9-47"><a href="#cb9-47" tabindex="-1"></a><span class="co">#&gt; 19.7241: Customer2: I can go in!</span></span>
<span id="cb9-48"><a href="#cb9-48" tabindex="-1"></a><span class="co">#&gt; 24.2037: Customer3: Here I am and the door is open.</span></span>
<span id="cb9-49"><a href="#cb9-49" tabindex="-1"></a><span class="co">#&gt; 24.2037: Customer3: I can go in!</span></span>
<span id="cb9-50"><a href="#cb9-50" tabindex="-1"></a><span class="co">#&gt; 33.3576: Customer4: Here I am and the door is open.</span></span>
<span id="cb9-51"><a href="#cb9-51" tabindex="-1"></a><span class="co">#&gt; 33.3576: Customer4: I can go in!</span></span>
<span id="cb9-52"><a href="#cb9-52" tabindex="-1"></a><span class="co">#&gt; simmer environment: bank | now: 79.2542060826083 | next: </span></span>
<span id="cb9-53"><a href="#cb9-53" tabindex="-1"></a><span class="co">#&gt; { Monitor: in memory }</span></span>
<span id="cb9-54"><a href="#cb9-54" tabindex="-1"></a><span class="co">#&gt; { Resource: door | monitored: TRUE | server status: 0(Inf) | queue status: 0(Inf) }</span></span>
<span id="cb9-55"><a href="#cb9-55" tabindex="-1"></a><span class="co">#&gt; { Resource: counter | monitored: TRUE | server status: 0(1) | queue status: 0(Inf) }</span></span>
<span id="cb9-56"><a href="#cb9-56" tabindex="-1"></a><span class="co">#&gt; { Source: Customer | monitored: 1 | n_generated: 5 }</span></span>
<span id="cb9-57"><a href="#cb9-57" tabindex="-1"></a><span class="co">#&gt; { Source: Doorman | monitored: 1 | n_generated: 1 }</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>bank <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>  <span class="fu">get_mon_arrivals</span>() <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>  <span class="fu">transform</span>(<span class="at">waiting_time =</span> end_time <span class="sc">-</span> start_time <span class="sc">-</span> activity_time)</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="co">#&gt;        name start_time end_time activity_time finished replication waiting_time</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="co">#&gt; 1  Doorman0   0.000000 19.72408     19.724085     TRUE           1      0.00000</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="co">#&gt; 2 Customer0   0.000000 46.61084     26.886751     TRUE           1     19.72408</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="co">#&gt; 3 Customer1   6.440758 64.20811     17.597279     TRUE           1     40.17008</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="co">#&gt; 4 Customer2   8.775635 71.50006      7.291950     TRUE           1     55.43248</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="co">#&gt; 5 Customer3  24.203687 73.96270      2.462632     TRUE           1     47.29638</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="co">#&gt; 6 Customer4  33.357600 79.25421      5.291510     TRUE           1     40.60510</span></span></code></pre></div>
<p>The output above programs shows how the first two customers have to
wait until the door is opened.</p>
</div>
<div id="wait-for-the-doorman-to-give-a-signal" class="section level1">
<h1>Wait for the doorman to give a signal</h1>
<p>Customers arrive at random, some of them getting to the bank before
the door is open. This is controlled by an automatic machine called the
doorman which opens the door only at intervals of 30 minutes (it is a
very secure bank). The customers wait for the door to be opened and all
those waiting enter and proceed to the counter. The door is closed
behind them.</p>
<p>There are at least two ways to implement this model. The first
example uses a schedule, and the second uses batching.</p>
<p>The principle behind the schedule is that the door is modelled as a
server with zero capacity for 30 minutes, then infinite capacity for
zero minutes, then repeat the 30-minute cycle. In the moment that it has
infinite capacity, all the customers will pass through the door
(i.e. they will be ‘served’).</p>
<p>For the sake of announcing in the log that the door has been opened,
a doorman trajectory is defined. The doorman has a <code>rollback</code>
step so that it keeps opening and shutting the door every 30 minutes for
ever.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">library</span>(simmer)</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>maxTime <span class="ot">=</span> <span class="dv">150</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>customer <span class="ot">&lt;-</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>  <span class="fu">trajectory</span>(<span class="st">&quot;Customer&#39;s path&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>  <span class="fu">log_</span>(<span class="st">&quot;Here I am, but the door is shut.&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>  <span class="fu">set_attribute</span>(<span class="st">&quot;start_time&quot;</span>, <span class="cf">function</span>() {<span class="fu">now</span>(bank)}) <span class="sc">%&gt;%</span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>  <span class="fu">seize</span>(<span class="st">&quot;door&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>  <span class="fu">log_</span>(<span class="st">&quot;The door is open!&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>  <span class="fu">log_</span>(<span class="cf">function</span>() {<span class="fu">paste</span>(<span class="st">&quot;Waited&quot;</span>, <span class="fu">now</span>(bank) <span class="sc">-</span> <span class="fu">get_attribute</span>(bank, <span class="st">&quot;start_time&quot;</span>))}) <span class="sc">%&gt;%</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a>  <span class="fu">release</span>(<span class="st">&quot;door&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a>  <span class="fu">seize</span>(<span class="st">&quot;counter&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a>  <span class="fu">timeout</span>(<span class="cf">function</span>() {<span class="fu">rexp</span>(<span class="dv">1</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>)}) <span class="sc">%&gt;%</span></span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a>  <span class="fu">release</span>(<span class="st">&quot;counter&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a>  <span class="fu">log_</span>(<span class="st">&quot;Finished.&quot;</span>)</span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a>door_schedule <span class="ot">&lt;-</span> <span class="fu">schedule</span>(<span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">30</span>), <span class="fu">c</span>(<span class="cn">Inf</span>, <span class="dv">0</span>), <span class="at">period =</span> <span class="dv">30</span>)</span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a></span>
<span id="cb11-20"><a href="#cb11-20" tabindex="-1"></a>doorman <span class="ot">&lt;-</span></span>
<span id="cb11-21"><a href="#cb11-21" tabindex="-1"></a>  <span class="fu">trajectory</span>(<span class="st">&quot;Doorman&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-22"><a href="#cb11-22" tabindex="-1"></a>  <span class="fu">timeout</span>(<span class="dv">30</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-23"><a href="#cb11-23" tabindex="-1"></a>  <span class="fu">log_</span>(<span class="st">&quot;You may enter.&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-24"><a href="#cb11-24" tabindex="-1"></a>  <span class="fu">rollback</span>(<span class="dv">2</span>, <span class="at">times =</span> <span class="cn">Inf</span>)</span>
<span id="cb11-25"><a href="#cb11-25" tabindex="-1"></a></span>
<span id="cb11-26"><a href="#cb11-26" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">393939</span>)</span>
<span id="cb11-27"><a href="#cb11-27" tabindex="-1"></a>bank <span class="ot">&lt;-</span> <span class="fu">simmer</span>(<span class="st">&quot;bank&quot;</span>)</span>
<span id="cb11-28"><a href="#cb11-28" tabindex="-1"></a>bank <span class="sc">%&gt;%</span></span>
<span id="cb11-29"><a href="#cb11-29" tabindex="-1"></a>  <span class="fu">add_resource</span>(<span class="st">&quot;door&quot;</span>, <span class="at">capacity =</span> door_schedule) <span class="sc">%&gt;%</span></span>
<span id="cb11-30"><a href="#cb11-30" tabindex="-1"></a>  <span class="fu">add_resource</span>(<span class="st">&quot;counter&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-31"><a href="#cb11-31" tabindex="-1"></a>  <span class="fu">add_generator</span>(<span class="st">&quot;Customer&quot;</span>,</span>
<span id="cb11-32"><a href="#cb11-32" tabindex="-1"></a>                customer,</span>
<span id="cb11-33"><a href="#cb11-33" tabindex="-1"></a>                <span class="fu">at</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">cumsum</span>(<span class="fu">rexp</span>(<span class="dv">5</span> <span class="sc">-</span> <span class="dv">1</span>, <span class="fl">0.1</span>))))) <span class="sc">%&gt;%</span></span>
<span id="cb11-34"><a href="#cb11-34" tabindex="-1"></a>  <span class="fu">add_generator</span>(<span class="st">&quot;Doorman&quot;</span>, doorman, <span class="fu">at</span>(<span class="dv">0</span>))</span>
<span id="cb11-35"><a href="#cb11-35" tabindex="-1"></a><span class="co">#&gt; simmer environment: bank | now: 0 | next: 0</span></span>
<span id="cb11-36"><a href="#cb11-36" tabindex="-1"></a><span class="co">#&gt; { Monitor: in memory }</span></span>
<span id="cb11-37"><a href="#cb11-37" tabindex="-1"></a><span class="co">#&gt; { Resource: door | monitored: TRUE | server status: 0(0) | queue status: 0(Inf) }</span></span>
<span id="cb11-38"><a href="#cb11-38" tabindex="-1"></a><span class="co">#&gt; { Resource: counter | monitored: TRUE | server status: 0(1) | queue status: 0(Inf) }</span></span>
<span id="cb11-39"><a href="#cb11-39" tabindex="-1"></a><span class="co">#&gt; { Source: Customer | monitored: 1 | n_generated: 0 }</span></span>
<span id="cb11-40"><a href="#cb11-40" tabindex="-1"></a><span class="co">#&gt; { Source: Doorman | monitored: 1 | n_generated: 0 }</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>bank <span class="sc">%&gt;%</span> <span class="fu">run</span>(<span class="at">until =</span> maxTime)</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="co">#&gt; 0: Customer0: Here I am, but the door is shut.</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="co">#&gt; 25.4605: Customer1: Here I am, but the door is shut.</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="co">#&gt; 30: Doorman0: You may enter.</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="co">#&gt; 30: Customer0: The door is open!</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="co">#&gt; 30: Customer0: Waited 30</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="co">#&gt; 30: Customer1: The door is open!</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="co">#&gt; 30: Customer1: Waited 4.53951782839885</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="co">#&gt; 35.4334: Customer2: Here I am, but the door is shut.</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="co">#&gt; 36.0565: Customer0: Finished.</span></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="co">#&gt; 40.6413: Customer3: Here I am, but the door is shut.</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a><span class="co">#&gt; 48.7442: Customer1: Finished.</span></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a><span class="co">#&gt; 49.063: Customer4: Here I am, but the door is shut.</span></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a><span class="co">#&gt; 60: Doorman0: You may enter.</span></span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a><span class="co">#&gt; 60: Customer2: The door is open!</span></span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a><span class="co">#&gt; 60: Customer2: Waited 24.566617201638</span></span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a><span class="co">#&gt; 60: Customer3: The door is open!</span></span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a><span class="co">#&gt; 60: Customer3: Waited 19.3586741095377</span></span>
<span id="cb12-20"><a href="#cb12-20" tabindex="-1"></a><span class="co">#&gt; 60: Customer4: The door is open!</span></span>
<span id="cb12-21"><a href="#cb12-21" tabindex="-1"></a><span class="co">#&gt; 60: Customer4: Waited 10.9369934153668</span></span>
<span id="cb12-22"><a href="#cb12-22" tabindex="-1"></a><span class="co">#&gt; 66.7763: Customer2: Finished.</span></span>
<span id="cb12-23"><a href="#cb12-23" tabindex="-1"></a><span class="co">#&gt; 71.3982: Customer3: Finished.</span></span>
<span id="cb12-24"><a href="#cb12-24" tabindex="-1"></a><span class="co">#&gt; 79.5795: Customer4: Finished.</span></span>
<span id="cb12-25"><a href="#cb12-25" tabindex="-1"></a><span class="co">#&gt; 90: Doorman0: You may enter.</span></span>
<span id="cb12-26"><a href="#cb12-26" tabindex="-1"></a><span class="co">#&gt; 120: Doorman0: You may enter.</span></span>
<span id="cb12-27"><a href="#cb12-27" tabindex="-1"></a><span class="co">#&gt; simmer environment: bank | now: 150 | next: 150</span></span>
<span id="cb12-28"><a href="#cb12-28" tabindex="-1"></a><span class="co">#&gt; { Monitor: in memory }</span></span>
<span id="cb12-29"><a href="#cb12-29" tabindex="-1"></a><span class="co">#&gt; { Resource: door | monitored: TRUE | server status: 0(0) | queue status: 0(Inf) }</span></span>
<span id="cb12-30"><a href="#cb12-30" tabindex="-1"></a><span class="co">#&gt; { Resource: counter | monitored: TRUE | server status: 0(1) | queue status: 0(Inf) }</span></span>
<span id="cb12-31"><a href="#cb12-31" tabindex="-1"></a><span class="co">#&gt; { Source: Customer | monitored: 1 | n_generated: 5 }</span></span>
<span id="cb12-32"><a href="#cb12-32" tabindex="-1"></a><span class="co">#&gt; { Source: Doorman | monitored: 1 | n_generated: 1 }</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>bank <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>  <span class="fu">get_mon_arrivals</span>() <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>  <span class="fu">transform</span>(<span class="at">waiting_time =</span> end_time <span class="sc">-</span> start_time <span class="sc">-</span> activity_time)</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="co">#&gt;        name start_time end_time activity_time finished replication waiting_time</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="co">#&gt; 1 Customer0    0.00000 36.05646      6.056458     TRUE           1     30.00000</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="co">#&gt; 2 Customer1   25.46048 48.74417     12.687713     TRUE           1     10.59598</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="co">#&gt; 3 Customer2   35.43338 66.77625      6.776253     TRUE           1     24.56662</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="co">#&gt; 4 Customer3   40.64133 71.39816      4.621910     TRUE           1     26.13493</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="co">#&gt; 5 Customer4   49.06301 79.57954      8.181380     TRUE           1     22.33516</span></span></code></pre></div>
<p>The output run for this program shows how the first two customers
have to wait until the door is opened, and then the next three have to
wait.</p>
<p>The second method is batching. Customers can be collected into
batches of a given size, or for a given time, or whichever occurs first.
Here, they are collected for periods of 30, and the number of customers
in each batch is unrestricted.</p>
<p>After the batch is created with <code>batch</code>, usually the
customers will all be processed together by a server, before separating
with <code>separate</code>. In this example, there is no need for a
server – the door is modelled by the batch itself – so the customers are
separated immediately after the batch.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="fu">library</span>(simmer)</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>maxTime <span class="ot">=</span> <span class="dv">150</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>customer <span class="ot">&lt;-</span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>  <span class="fu">trajectory</span>(<span class="st">&quot;Customer&#39;s path&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>  <span class="fu">log_</span>(<span class="st">&quot;Here I am, but the door is shut.&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>  <span class="fu">set_attribute</span>(<span class="st">&quot;start_time&quot;</span>, <span class="cf">function</span>() {<span class="fu">now</span>(bank)}) <span class="sc">%&gt;%</span></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>  <span class="fu">batch</span>(<span class="at">n =</span> <span class="cn">Inf</span>, <span class="at">timeout =</span> <span class="dv">30</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>  <span class="fu">separate</span>() <span class="sc">%&gt;%</span></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a>  <span class="fu">log_</span>(<span class="st">&quot;The door is open!&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a>  <span class="fu">log_</span>(<span class="cf">function</span>() {<span class="fu">paste</span>(<span class="st">&quot;Waited&quot;</span>, <span class="fu">now</span>(bank) <span class="sc">-</span> <span class="fu">get_attribute</span>(bank, <span class="st">&quot;start_time&quot;</span>))}) <span class="sc">%&gt;%</span></span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a>  <span class="fu">seize</span>(<span class="st">&quot;counter&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a>  <span class="fu">timeout</span>(<span class="cf">function</span>() {<span class="fu">rexp</span>(<span class="dv">1</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>)}) <span class="sc">%&gt;%</span></span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a>  <span class="fu">release</span>(<span class="st">&quot;counter&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a>  <span class="fu">log_</span>(<span class="st">&quot;Finished.&quot;</span>)</span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a>doorman <span class="ot">&lt;-</span></span>
<span id="cb14-19"><a href="#cb14-19" tabindex="-1"></a>  <span class="fu">trajectory</span>(<span class="st">&quot;Doorman&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-20"><a href="#cb14-20" tabindex="-1"></a>  <span class="fu">timeout</span>(<span class="dv">30</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-21"><a href="#cb14-21" tabindex="-1"></a>  <span class="fu">log_</span>(<span class="st">&quot;You may enter.&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-22"><a href="#cb14-22" tabindex="-1"></a>  <span class="fu">rollback</span>(<span class="dv">2</span>, <span class="at">times =</span> <span class="cn">Inf</span>)</span>
<span id="cb14-23"><a href="#cb14-23" tabindex="-1"></a></span>
<span id="cb14-24"><a href="#cb14-24" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">393939</span>)</span>
<span id="cb14-25"><a href="#cb14-25" tabindex="-1"></a>bank <span class="ot">&lt;-</span> <span class="fu">simmer</span>(<span class="st">&quot;bank&quot;</span>)</span>
<span id="cb14-26"><a href="#cb14-26" tabindex="-1"></a>bank <span class="sc">%&gt;%</span></span>
<span id="cb14-27"><a href="#cb14-27" tabindex="-1"></a>  <span class="fu">add_resource</span>(<span class="st">&quot;door&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-28"><a href="#cb14-28" tabindex="-1"></a>  <span class="fu">add_resource</span>(<span class="st">&quot;counter&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-29"><a href="#cb14-29" tabindex="-1"></a>  <span class="fu">add_generator</span>(<span class="st">&quot;Customer&quot;</span>,</span>
<span id="cb14-30"><a href="#cb14-30" tabindex="-1"></a>                customer,</span>
<span id="cb14-31"><a href="#cb14-31" tabindex="-1"></a>                <span class="fu">at</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">cumsum</span>(<span class="fu">rexp</span>(<span class="dv">5</span> <span class="sc">-</span> <span class="dv">1</span>, <span class="fl">0.1</span>))))) <span class="sc">%&gt;%</span></span>
<span id="cb14-32"><a href="#cb14-32" tabindex="-1"></a>  <span class="fu">add_generator</span>(<span class="st">&quot;Doorman&quot;</span>, doorman, <span class="fu">at</span>(<span class="dv">0</span>))</span>
<span id="cb14-33"><a href="#cb14-33" tabindex="-1"></a><span class="co">#&gt; simmer environment: bank | now: 0 | next: 0</span></span>
<span id="cb14-34"><a href="#cb14-34" tabindex="-1"></a><span class="co">#&gt; { Monitor: in memory }</span></span>
<span id="cb14-35"><a href="#cb14-35" tabindex="-1"></a><span class="co">#&gt; { Resource: door | monitored: TRUE | server status: 0(1) | queue status: 0(Inf) }</span></span>
<span id="cb14-36"><a href="#cb14-36" tabindex="-1"></a><span class="co">#&gt; { Resource: counter | monitored: TRUE | server status: 0(1) | queue status: 0(Inf) }</span></span>
<span id="cb14-37"><a href="#cb14-37" tabindex="-1"></a><span class="co">#&gt; { Source: Customer | monitored: 1 | n_generated: 0 }</span></span>
<span id="cb14-38"><a href="#cb14-38" tabindex="-1"></a><span class="co">#&gt; { Source: Doorman | monitored: 1 | n_generated: 0 }</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>bank <span class="sc">%&gt;%</span> <span class="fu">run</span>(<span class="at">until =</span> maxTime)</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="co">#&gt; 0: Customer0: Here I am, but the door is shut.</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="co">#&gt; 25.4605: Customer1: Here I am, but the door is shut.</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="co">#&gt; 30: Doorman0: You may enter.</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="co">#&gt; 30: Customer0: The door is open!</span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="co">#&gt; 30: Customer0: Waited 30</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a><span class="co">#&gt; 30: Customer1: The door is open!</span></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a><span class="co">#&gt; 30: Customer1: Waited 4.53951782839885</span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a><span class="co">#&gt; 35.4334: Customer2: Here I am, but the door is shut.</span></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a><span class="co">#&gt; 36.0565: Customer0: Finished.</span></span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a><span class="co">#&gt; 40.6413: Customer3: Here I am, but the door is shut.</span></span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a><span class="co">#&gt; 48.7442: Customer1: Finished.</span></span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a><span class="co">#&gt; 49.063: Customer4: Here I am, but the door is shut.</span></span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a><span class="co">#&gt; 60: Doorman0: You may enter.</span></span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a><span class="co">#&gt; 65.4334: Customer2: The door is open!</span></span>
<span id="cb15-17"><a href="#cb15-17" tabindex="-1"></a><span class="co">#&gt; 65.4334: Customer2: Waited 30</span></span>
<span id="cb15-18"><a href="#cb15-18" tabindex="-1"></a><span class="co">#&gt; 65.4334: Customer3: The door is open!</span></span>
<span id="cb15-19"><a href="#cb15-19" tabindex="-1"></a><span class="co">#&gt; 65.4334: Customer3: Waited 24.7920569078997</span></span>
<span id="cb15-20"><a href="#cb15-20" tabindex="-1"></a><span class="co">#&gt; 65.4334: Customer4: The door is open!</span></span>
<span id="cb15-21"><a href="#cb15-21" tabindex="-1"></a><span class="co">#&gt; 65.4334: Customer4: Waited 16.3703762137288</span></span>
<span id="cb15-22"><a href="#cb15-22" tabindex="-1"></a><span class="co">#&gt; 72.2096: Customer2: Finished.</span></span>
<span id="cb15-23"><a href="#cb15-23" tabindex="-1"></a><span class="co">#&gt; 76.8315: Customer3: Finished.</span></span>
<span id="cb15-24"><a href="#cb15-24" tabindex="-1"></a><span class="co">#&gt; 85.0129: Customer4: Finished.</span></span>
<span id="cb15-25"><a href="#cb15-25" tabindex="-1"></a><span class="co">#&gt; 90: Doorman0: You may enter.</span></span>
<span id="cb15-26"><a href="#cb15-26" tabindex="-1"></a><span class="co">#&gt; 120: Doorman0: You may enter.</span></span>
<span id="cb15-27"><a href="#cb15-27" tabindex="-1"></a><span class="co">#&gt; simmer environment: bank | now: 150 | next: 150</span></span>
<span id="cb15-28"><a href="#cb15-28" tabindex="-1"></a><span class="co">#&gt; { Monitor: in memory }</span></span>
<span id="cb15-29"><a href="#cb15-29" tabindex="-1"></a><span class="co">#&gt; { Resource: door | monitored: TRUE | server status: 0(1) | queue status: 0(Inf) }</span></span>
<span id="cb15-30"><a href="#cb15-30" tabindex="-1"></a><span class="co">#&gt; { Resource: counter | monitored: TRUE | server status: 0(1) | queue status: 0(Inf) }</span></span>
<span id="cb15-31"><a href="#cb15-31" tabindex="-1"></a><span class="co">#&gt; { Source: Customer | monitored: 1 | n_generated: 5 }</span></span>
<span id="cb15-32"><a href="#cb15-32" tabindex="-1"></a><span class="co">#&gt; { Source: Doorman | monitored: 1 | n_generated: 1 }</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>bank <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>  <span class="fu">get_mon_arrivals</span>() <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>  <span class="fu">transform</span>(<span class="at">waiting_time =</span> end_time <span class="sc">-</span> start_time <span class="sc">-</span> activity_time)</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="co">#&gt;        name start_time end_time activity_time finished replication waiting_time</span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="co">#&gt; 1 Customer0    0.00000 36.05646      6.056458     TRUE           1     30.00000</span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="co">#&gt; 2 Customer1   25.46048 48.74417     12.687713     TRUE           1     10.59598</span></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a><span class="co">#&gt; 3 Customer2   35.43338 72.20964      6.776253     TRUE           1     30.00000</span></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a><span class="co">#&gt; 4 Customer3   40.64133 76.83155      4.621910     TRUE           1     31.56831</span></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a><span class="co">#&gt; 5 Customer4   49.06301 85.01293      8.181380     TRUE           1     27.76854</span></span></code></pre></div>
<p>This second method gives the same output as the first.</p>
<div id="monitors" class="section level2">
<h2>Monitors</h2>
<p>Monitors record events in a simulation. Unlike SimPy, Simmer does
this by default, so the records are available after – in fact, even
during – a simulation. Data that is collected by monitors is available
from the following functions:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>get_capacity</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>get_mon_arrivals</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>get_mon_attributes</span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>get_mon_resources</span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>get_n_activities</span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>get_n_generated</span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a>get_queue_count</span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a>get_queue_size</span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a>get_server_count</span></code></pre></div>
<p>The <code>get_mon_*()</code> functions return a data frame (which is
growing during the simulation, so that, although possible, it is
computationally expensive to call them from inside a trajectory). The
others return a numeric value.</p>
<div id="plotting-a-histogram-of-monitor-results" class="section level3">
<h3>Plotting a histogram of monitor results</h3>
<p>A histogram of the amount of time that customers spend in the bank
can be plotted by taking some basic information – start and end time of
each customer – from the <code>get_mon_arrivals()</code> function, and
then calculating the elapsed time. This example draws the plot with the
<code>ggplot2</code> package, but other plotting packages, and base R
graphics, could do something similar.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="fu">library</span>(simmer)</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="fu">library</span>(simmer.plot)</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a><span class="co"># library(ggplot2) # (automatically loaded with simmer.plot)</span></span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>bank <span class="ot">&lt;-</span> <span class="fu">simmer</span>()</span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a>customer <span class="ot">&lt;-</span></span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a>  <span class="fu">trajectory</span>(<span class="st">&quot;Customer&#39;s path&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a>  <span class="fu">seize</span>(<span class="st">&quot;counter&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a>  <span class="fu">timeout</span>(<span class="dv">12</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a>  <span class="fu">release</span>(<span class="st">&quot;counter&quot;</span>)</span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">393939</span>)</span>
<span id="cb18-14"><a href="#cb18-14" tabindex="-1"></a>bank <span class="ot">&lt;-</span></span>
<span id="cb18-15"><a href="#cb18-15" tabindex="-1"></a>  <span class="fu">simmer</span>(<span class="st">&quot;bank&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-16"><a href="#cb18-16" tabindex="-1"></a>  <span class="fu">add_resource</span>(<span class="st">&quot;counter&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-17"><a href="#cb18-17" tabindex="-1"></a>  <span class="fu">add_generator</span>(<span class="st">&quot;Customer&quot;</span>,</span>
<span id="cb18-18"><a href="#cb18-18" tabindex="-1"></a>                customer,</span>
<span id="cb18-19"><a href="#cb18-19" tabindex="-1"></a>                <span class="fu">at</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">cumsum</span>(<span class="fu">rexp</span>(<span class="dv">20</span> <span class="sc">-</span> <span class="dv">1</span>, <span class="fl">0.1</span>)))))</span>
<span id="cb18-20"><a href="#cb18-20" tabindex="-1"></a></span>
<span id="cb18-21"><a href="#cb18-21" tabindex="-1"></a>bank <span class="sc">%&gt;%</span> <span class="fu">run</span>(<span class="dv">400</span>)</span>
<span id="cb18-22"><a href="#cb18-22" tabindex="-1"></a><span class="co">#&gt; simmer environment: bank | now: 253.460482171601 | next: </span></span>
<span id="cb18-23"><a href="#cb18-23" tabindex="-1"></a><span class="co">#&gt; { Monitor: in memory }</span></span>
<span id="cb18-24"><a href="#cb18-24" tabindex="-1"></a><span class="co">#&gt; { Resource: counter | monitored: TRUE | server status: 0(1) | queue status: 0(Inf) }</span></span>
<span id="cb18-25"><a href="#cb18-25" tabindex="-1"></a><span class="co">#&gt; { Source: Customer | monitored: 1 | n_generated: 20 }</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>bank <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>  get_mon_arrivals <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(end_time <span class="sc">-</span> start_time)) <span class="sc">+</span></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>  <span class="fu">geom_histogram</span>() <span class="sc">+</span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Time spent in the system&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Number of customers&quot;</span>)</span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a><span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></span></code></pre></div>
<p><img role="img" src="data:image/png;base64,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" style="display: block; margin: auto;" /></p>
</div>
<div id="monitoring-a-resource" class="section level3">
<h3>Monitoring a resource</h3>
<p>Now consider observing the number of customers waiting or active in a
Resource.</p>
<p><code>get_mon_resources()</code> returns a table of states and times
for the counter. Whenever a customer enters/leaves a queue/counter, a
new row is created recording the number of customers in the queue, the
counter and the system as a whole. We call this the ‘state’. The amount
of time that the state lasts is the difference in time between one state
and the next, which we calculate with the <code>diff()</code> function.
Finally, we multiply the number of customers in each state by the
duration of the state, and divide by the duration of the simulation (the
time at the end) to get the average.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="fu">library</span>(simmer)</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a>bank <span class="ot">&lt;-</span> <span class="fu">simmer</span>()</span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a>customer <span class="ot">&lt;-</span></span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a>  <span class="fu">trajectory</span>(<span class="st">&quot;Customer&#39;s path&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a>  <span class="fu">log_</span>(<span class="st">&quot;Arrived&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a>  <span class="fu">set_attribute</span>(<span class="st">&quot;start_time&quot;</span>, <span class="cf">function</span>() {<span class="fu">now</span>(bank)}) <span class="sc">%&gt;%</span></span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a>  <span class="fu">seize</span>(<span class="st">&quot;counter&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-12"><a href="#cb20-12" tabindex="-1"></a>  <span class="fu">log_</span>(<span class="st">&quot;Got counter&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-13"><a href="#cb20-13" tabindex="-1"></a>  <span class="fu">log_</span>(<span class="cf">function</span>() {<span class="fu">paste</span>(<span class="st">&quot;Waited&quot;</span>, <span class="fu">now</span>(bank) <span class="sc">-</span> <span class="fu">get_attribute</span>(bank, <span class="st">&quot;start_time&quot;</span>))}) <span class="sc">%&gt;%</span></span>
<span id="cb20-14"><a href="#cb20-14" tabindex="-1"></a>  <span class="fu">timeout</span>(<span class="dv">12</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-15"><a href="#cb20-15" tabindex="-1"></a>  <span class="fu">release</span>(<span class="st">&quot;counter&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-16"><a href="#cb20-16" tabindex="-1"></a>  <span class="fu">log_</span>(<span class="st">&quot;Finished&quot;</span>)</span>
<span id="cb20-17"><a href="#cb20-17" tabindex="-1"></a></span>
<span id="cb20-18"><a href="#cb20-18" tabindex="-1"></a>bank <span class="ot">&lt;-</span></span>
<span id="cb20-19"><a href="#cb20-19" tabindex="-1"></a>  <span class="fu">simmer</span>(<span class="st">&quot;bank&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-20"><a href="#cb20-20" tabindex="-1"></a>  <span class="fu">add_resource</span>(<span class="st">&quot;counter&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-21"><a href="#cb20-21" tabindex="-1"></a>  <span class="fu">add_generator</span>(<span class="st">&quot;Customer&quot;</span>, customer, <span class="cf">function</span>() {<span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">rexp</span>(<span class="dv">4</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>), <span class="sc">-</span><span class="dv">1</span>)})</span>
<span id="cb20-22"><a href="#cb20-22" tabindex="-1"></a></span>
<span id="cb20-23"><a href="#cb20-23" tabindex="-1"></a>bank <span class="sc">%&gt;%</span> <span class="fu">run</span>(<span class="at">until =</span> <span class="dv">400</span>)</span>
<span id="cb20-24"><a href="#cb20-24" tabindex="-1"></a><span class="co">#&gt; 0: Customer0: Arrived</span></span>
<span id="cb20-25"><a href="#cb20-25" tabindex="-1"></a><span class="co">#&gt; 0: Customer0: Got counter</span></span>
<span id="cb20-26"><a href="#cb20-26" tabindex="-1"></a><span class="co">#&gt; 0: Customer0: Waited 0</span></span>
<span id="cb20-27"><a href="#cb20-27" tabindex="-1"></a><span class="co">#&gt; 12: Customer0: Finished</span></span>
<span id="cb20-28"><a href="#cb20-28" tabindex="-1"></a><span class="co">#&gt; 25.0176: Customer1: Arrived</span></span>
<span id="cb20-29"><a href="#cb20-29" tabindex="-1"></a><span class="co">#&gt; 25.0176: Customer1: Got counter</span></span>
<span id="cb20-30"><a href="#cb20-30" tabindex="-1"></a><span class="co">#&gt; 25.0176: Customer1: Waited 0</span></span>
<span id="cb20-31"><a href="#cb20-31" tabindex="-1"></a><span class="co">#&gt; 27.4852: Customer2: Arrived</span></span>
<span id="cb20-32"><a href="#cb20-32" tabindex="-1"></a><span class="co">#&gt; 27.551: Customer3: Arrived</span></span>
<span id="cb20-33"><a href="#cb20-33" tabindex="-1"></a><span class="co">#&gt; 37.0176: Customer1: Finished</span></span>
<span id="cb20-34"><a href="#cb20-34" tabindex="-1"></a><span class="co">#&gt; 37.0176: Customer2: Got counter</span></span>
<span id="cb20-35"><a href="#cb20-35" tabindex="-1"></a><span class="co">#&gt; 37.0176: Customer2: Waited 9.53241116646677</span></span>
<span id="cb20-36"><a href="#cb20-36" tabindex="-1"></a><span class="co">#&gt; 44.9785: Customer4: Arrived</span></span>
<span id="cb20-37"><a href="#cb20-37" tabindex="-1"></a><span class="co">#&gt; 49.0176: Customer2: Finished</span></span>
<span id="cb20-38"><a href="#cb20-38" tabindex="-1"></a><span class="co">#&gt; 49.0176: Customer3: Got counter</span></span>
<span id="cb20-39"><a href="#cb20-39" tabindex="-1"></a><span class="co">#&gt; 49.0176: Customer3: Waited 21.466591599012</span></span>
<span id="cb20-40"><a href="#cb20-40" tabindex="-1"></a><span class="co">#&gt; 61.0176: Customer3: Finished</span></span>
<span id="cb20-41"><a href="#cb20-41" tabindex="-1"></a><span class="co">#&gt; 61.0176: Customer4: Got counter</span></span>
<span id="cb20-42"><a href="#cb20-42" tabindex="-1"></a><span class="co">#&gt; 61.0176: Customer4: Waited 16.0391307005949</span></span>
<span id="cb20-43"><a href="#cb20-43" tabindex="-1"></a><span class="co">#&gt; 73.0176: Customer4: Finished</span></span>
<span id="cb20-44"><a href="#cb20-44" tabindex="-1"></a><span class="co">#&gt; simmer environment: bank | now: 73.0175860496223 | next: </span></span>
<span id="cb20-45"><a href="#cb20-45" tabindex="-1"></a><span class="co">#&gt; { Monitor: in memory }</span></span>
<span id="cb20-46"><a href="#cb20-46" tabindex="-1"></a><span class="co">#&gt; { Resource: counter | monitored: TRUE | server status: 0(1) | queue status: 0(Inf) }</span></span>
<span id="cb20-47"><a href="#cb20-47" tabindex="-1"></a><span class="co">#&gt; { Source: Customer | monitored: 1 | n_generated: 5 }</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>customer_monitor <span class="ot">&lt;-</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>  <span class="fu">get_mon_arrivals</span>(bank) <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>  <span class="fu">transform</span>(<span class="at">wait =</span> end_time <span class="sc">-</span> start_time <span class="sc">-</span> activity_time)</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>mean_waiting_time <span class="ot">&lt;-</span> <span class="fu">mean</span>(customer_monitor<span class="sc">$</span>wait)</span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>resource_monitor <span class="ot">&lt;-</span> <span class="fu">get_mon_resources</span>(bank)</span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a>queue_state <span class="ot">&lt;-</span> <span class="fu">head</span>(resource_monitor<span class="sc">$</span>queue, <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a>server_state <span class="ot">&lt;-</span> <span class="fu">head</span>(resource_monitor<span class="sc">$</span>server, <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a>time_state_lasted <span class="ot">&lt;-</span> <span class="fu">diff</span>(resource_monitor<span class="sc">$</span>time)</span>
<span id="cb21-12"><a href="#cb21-12" tabindex="-1"></a>time_at_end <span class="ot">&lt;-</span> <span class="fu">max</span>(resource_monitor<span class="sc">$</span>time)</span>
<span id="cb21-13"><a href="#cb21-13" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" tabindex="-1"></a>mean_active_customers <span class="ot">&lt;-</span> <span class="fu">sum</span>(server_state <span class="sc">*</span> time_state_lasted) <span class="sc">/</span> time_at_end</span>
<span id="cb21-15"><a href="#cb21-15" tabindex="-1"></a>mean_waiting_customers <span class="ot">&lt;-</span> <span class="fu">sum</span>(queue_state <span class="sc">*</span> time_state_lasted) <span class="sc">/</span> time_at_end</span>
<span id="cb21-16"><a href="#cb21-16" tabindex="-1"></a></span>
<span id="cb21-17"><a href="#cb21-17" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot; Average waiting = &quot;</span>, mean_waiting_customers, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb21-18"><a href="#cb21-18" tabindex="-1"></a>    <span class="st">&quot;Average active  = &quot;</span>, mean_active_customers, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb21-19"><a href="#cb21-19" tabindex="-1"></a><span class="co">#&gt;  Average waiting =  0.6442028 </span></span>
<span id="cb21-20"><a href="#cb21-20" tabindex="-1"></a><span class="co">#&gt;  Average active  =  0.8217199</span></span></code></pre></div>
</div>
<div id="plotting-from-resource-monitors" class="section level3">
<h3>Plotting from resource monitors</h3>
<p>All the <code>get_mon_*()</code> return information that enables us
to graph the output. Alternative plotting packages can be used; here we
use the <code>simmer.plot</code> package just to graph the number of
customers waiting for the counter.</p>
<p>The <code>simmer.plot</code> package is imported at line 2. The
function <code>get_mon_resources()</code> is not called because the
function <code>plot()</code> calles <code>get_mon_resources()</code>
itself. The <code>plot()</code> function has arguments to specifiy what
to plot.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="fu">library</span>(simmer)</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="fu">library</span>(simmer.plot)</span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a>timeInBank <span class="ot">&lt;-</span> <span class="dv">12</span> <span class="co"># mean, minutes</span></span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" tabindex="-1"></a>bank <span class="ot">&lt;-</span> <span class="fu">simmer</span>()</span>
<span id="cb22-9"><a href="#cb22-9" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" tabindex="-1"></a>customer <span class="ot">&lt;-</span></span>
<span id="cb22-11"><a href="#cb22-11" tabindex="-1"></a>  <span class="fu">trajectory</span>(<span class="st">&quot;Customer&#39;s path&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-12"><a href="#cb22-12" tabindex="-1"></a>  <span class="fu">set_attribute</span>(<span class="st">&quot;start_time&quot;</span>, <span class="cf">function</span>() {<span class="fu">now</span>(bank)}) <span class="sc">%&gt;%</span></span>
<span id="cb22-13"><a href="#cb22-13" tabindex="-1"></a>  <span class="fu">seize</span>(<span class="st">&quot;counter&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-14"><a href="#cb22-14" tabindex="-1"></a>  <span class="fu">timeout</span>(<span class="cf">function</span>() {<span class="fu">rexp</span>(<span class="dv">1</span>, <span class="dv">1</span><span class="sc">/</span>timeInBank)}) <span class="sc">%&gt;%</span></span>
<span id="cb22-15"><a href="#cb22-15" tabindex="-1"></a>  <span class="fu">release</span>(<span class="st">&quot;counter&quot;</span>)</span>
<span id="cb22-16"><a href="#cb22-16" tabindex="-1"></a></span>
<span id="cb22-17"><a href="#cb22-17" tabindex="-1"></a>bank <span class="ot">&lt;-</span></span>
<span id="cb22-18"><a href="#cb22-18" tabindex="-1"></a>  <span class="fu">simmer</span>(<span class="st">&quot;bank&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-19"><a href="#cb22-19" tabindex="-1"></a>  <span class="fu">add_resource</span>(<span class="st">&quot;counter&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-20"><a href="#cb22-20" tabindex="-1"></a>  <span class="fu">add_generator</span>(<span class="st">&quot;Customer&quot;</span>, customer, <span class="cf">function</span>() {<span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">rexp</span>(<span class="dv">19</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>), <span class="sc">-</span><span class="dv">1</span>)})</span>
<span id="cb22-21"><a href="#cb22-21" tabindex="-1"></a></span>
<span id="cb22-22"><a href="#cb22-22" tabindex="-1"></a>bank <span class="sc">%&gt;%</span> <span class="fu">run</span>(<span class="at">until =</span> <span class="dv">400</span>)</span>
<span id="cb22-23"><a href="#cb22-23" tabindex="-1"></a><span class="co">#&gt; simmer environment: bank | now: 248.706140163915 | next: </span></span>
<span id="cb22-24"><a href="#cb22-24" tabindex="-1"></a><span class="co">#&gt; { Monitor: in memory }</span></span>
<span id="cb22-25"><a href="#cb22-25" tabindex="-1"></a><span class="co">#&gt; { Resource: counter | monitored: TRUE | server status: 0(1) | queue status: 0(Inf) }</span></span>
<span id="cb22-26"><a href="#cb22-26" tabindex="-1"></a><span class="co">#&gt; { Source: Customer | monitored: 1 | n_generated: 20 }</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">get_mon_resources</span>(bank),</span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a>     <span class="at">metric =</span> <span class="st">&quot;usage&quot;</span>,</span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a>     <span class="at">names =</span> <span class="st">&quot;counter&quot;</span>,</span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a>     <span class="at">items =</span> <span class="st">&quot;system&quot;</span>,</span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a>     <span class="at">steps =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img role="img" src="data:image/png;base64,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" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
